# 2022-2023 学年 秋冬学期 期末复习

本页面针对 2022-2023 学年 zkg 老师划定的范围进行复习，其他内容因时间关系不详细展开。以下目录基于《计算机网络》（第六版）[美] Andrew S. Tanenbaum 等 著。

由于网络安全部分没有其他参考资料，因此内容会更加详细，我放在了另一个单独的文档中。

## 第一章 引言（小于10分）

### 1.5 网络协议

### 1.6 参考模型（OSI）*

## 第2章 物理层（小于10分）
### 2.1 导向的传输介质

**导向传输介质Guided trans media**

- 磁介质
- 双绞线 twisted pair：绞合以减少相邻导线的电磁干扰在双绞线外加一层金属丝编织的屏蔽层，可以进一步提高抗电磁干扰的能力，称为屏蔽双绞线 STP（Shielded Twisted Pair）；没有屏蔽层的称为非屏蔽双绞线 UTP（Unshielded Twisted Pair）。
- 同轴电缆 coaxial cable
- 光纤 fiber optics：

*补充：**非导向传输介质 / 无线传输Wireless transmission**

- 无线电波 Radio有较强的的穿透能力，不需对准某个方向；无线手机通信、WLAN (wireless local area network) 等；
- 微波、红外线、激光有很强的方向性，沿直线传播。

注意区分 S/N ratio 和以 dB 为单位的两种信噪比，前者就是 S/N，后者是 10$\log_{10}$S/N。

semiconductor laser：半导体激光

注意区分 data transfer rate 数据传输速率和 signal propagation rate 信号传播速率，前者指数据发送到链路上的速率，单位为 b/s，后者指在链路上的传播速率（如电磁波在真空中传播速率为光速），单位 m/s。**计算数据传输速率要特别注意不要混淆 byte 和 bit，然后注意文件大小 K，M 等是以 2 为底的指数，传输速率是以 10 为底的指数。

下图为电话网络的基本结构：

![](./assets/tel-1.png)

其中 end office 为端局，toll office 为长途局，二者间连接为中继线。

Full Duplex 全双工

### 2.4 从波形到比特*

数据与代表它们的信号之间的转换过程称为数字调制 digital modulation

**基带传输 Baseband Transmission**

直接将数据转换为数字信号，数字信号是离散的。这里我们讨论的其实是对比特流进行编码（在课本中这部分也称为调制）；在通带传输中我们讨论真正的调制，即将数据转换为连续的模拟信号。

- ![img](https://cdn.nlark.com/yuque/0/2021/png/641515/1633520544956-bc74c216-0d3a-4f31-a9bc-9c873e979802.png)
- NRZ   Non-Return to Zero用正电压 / 有光表示 1，负电压 / 没有光表示 0。问题：如果是 0 和 1 交替，接收端可以在每一次变化时校准；但是如果一直是 0 或者 1 的话那过一段时间可能就数错了。即：无法传递时钟信号，双方难以同步；除非双方都带有时钟线。
- Manchester （以太网 Ethernet 的编码方式）用一个高和一个低表示 1，一个低一个高表示 0（实际上就是与一个时钟信号做了 XOR，如图）。解决了时钟信号的问题，即每个码元中间一定有电平跳变。问题是带宽开销增大了一倍。
- NRZI   NRZ Invert（USB 2.0 的编码方式）用信号翻转表示 1，信号不变表示 0。没有带宽开销的增加；解决了一长串都是 1 的问题；但是如果一长串都是 0 还是不行。4B/5B mapping 解决了这个问题，保证映射结果永远不会出现连续 3 个 0，虽然增加了 25% 的开销，但是比 Manchester 好一些：

- - ![img](https://cdn.nlark.com/yuque/0/2021/png/641515/1633523381106-d1b4375f-e32a-418d-9076-25e469479b0a.png)

- 扰频/倒频 scrambling尝试解决一长串 0 和 1 的问题。发送数据之前，用一个伪随机序列 XOR 数据，接收器用同样的序列 XOR 后得到结果。问题：不能完全保证不会出现一长串 0 或 1；尤其是序列较短之类的情况可能出错或被恶意用户攻击。
- 双极编码 bipolar encoding / AMI, Alternate Mark Inversion这种编码方式关注信号的平衡性；短时间内正电压和负电压一样多的信号称为平衡信号 balanced signal，这样的信号均值为 0，即没有直流分量；由于传输介质的物理性质，没有直流分量是一个优点。这种编码方式用 +1 或者 -1 表示 1，每次的 1 与前一次的 1 表示法相反，保证最多只差 1 个；用 0 表示 0。
- 还有一种 8B/10B 编码模式 同时考虑这些问题，通过映射保证没有超过 5 个连续的 0 或 1，同时保持 0 和 1 数目相对均等；其额外带宽消耗也只有 25%。

**通带传输 Passband Transmission**

通过调节载波信号的幅值、相位或频率来运载数据，占据以载波信号频率为中心的一段频带，用于无线和光纤信道。

- 幅移键控 ASK, Amplitude Shift Keying通过两个不同的振幅分别表示 0 和 1；可以用更多的幅值等级表示更多的信息。
- 频移键控 FSK, Frequency Shift Keying类似地，通过不同频率表示不同的码元。
- 相移键控 PSK, Phase Shift Keying将载波波形偏移一定的相位。二进制相移键控 BPSK, Binary PSK 将波形偏移 0° 和 180°；正交相移键控 QPSK, Quadrature PSK 将波形偏移 45°, 135°, 225° 和 315°。
- 为了让每个码元传输更多 bit 的信息，也可以将这些方式综合起来使用。下面的 星座图 constellation diagram 中用黑点表示一个合法的振幅和相位的组合；其中每个黑点到原点的距离表示振幅，和 x 轴正方向所成角度表示相位偏移。该图中 (a) 即为前述 QPSK，而后面两个图是 正交调幅 QAM, Quadrature Amplitude Modulation 的两个实例，它们的每个 symbol 分别携带 4 bit 和 6 bit 的信息。
- ![img](https://cdn.nlark.com/yuque/0/2021/png/641515/1633615422512-396a594f-5b18-4337-9121-1dff2a4b94ed.png)
- 为星座图分配每个黑点代表的 bit 时，需要考虑少量的突发噪音不会导致很多 bit 出错。可以使用 Gray code 解决这一问题。
- ![img](https://cdn.nlark.com/yuque/0/2021/png/641515/1633615696410-390e669f-92fe-4e94-a378-b39842f5863a.png)

**多路复用**

* 频分复用 FDM, Frequency Division Multiplexing：将信道带宽分割为多种不同频带的子信道，实现多路复用。每个频带之间保留足够宽的距离，保证相邻的频带不会相互重叠。这一部分保护间隔称为 保护频带 guard band；
* 正交频分复用 OFDM, Orthogonal FDM：基本思想是：每个子载波相互正交；即每个子载波在其他子载波的中心频率处能量为 0。这样在每个子载波中心频率处取样，就不会被其他子载波干扰了。这样的方式不需要 guard band，且频带利用率很高；

![img](https://cdn.nlark.com/yuque/0/2021/png/641515/1633669700504-b2555a6b-5874-4832-914a-6e5551ec170b.png)

- 

* 时分复用 TDM, Time Division Multiplexing
* 码分复用 CDM, Code Division Multiplexing

PCM：脉冲编码调制

### 2.6 蜂窝网络（CDMA）

码分多址（CDMA, Code Division Multiple Access）是 3G 系统的基础。

数据交换的几种方式：

* 电路交换 circuit switching：数据传输前，两个节点之间必须先建立一条专用（双方独占）的物理通信路径，分为三个阶段：连接建立-数据传输-连接释放；
* 报文交换 message switching：数据交换的单位是报文，在交换节点采用存储转发方式传输；
* 分组交换 package switching：包括虚电路 virtual circuit 和数据报 data gram。同样采用存储转发模式，但限制每次传送的数据块大小上限，将大的数据块划分为合理的的小数据块，再加上必要控制信息构成分组（packet）。数据报不保证可靠性，分组不一定有序到达，虚电路将数据报和电路交换结合，在通信双方之间里逻辑线路，数据分组需要有分组号、校验号和虚电路号等，提供可靠通信功能，保证每个分组正确且有序到达。

## 第3章 数据链路层（小于10分）
### 3.1 数据链路层的设计问题（Framing）
### 3.2 错误检测和纠正（Hamming distance, CRC）
### 3.4 滑动窗口协议

数据链路层可靠传输机制通过使用确认和超时重传两种机制完成。自动重传请求（ARQ，Automatic Repeat reQuest）通过接收方请求发送方重传出错的数据帧来恢复出错的帧。我们有以下三种 ARQ：

One-Bit Sliding Window Protocol 单帧滑动窗口协议（停止-等待协议 stop-and-wait）

* 发送窗口大小：1，接收窗口大小：1；
* 发送帧交替用 0 和 1 来标识，确认帧使用 ACK0 和 ACK1；
* 为了超时重发和判定重复帧需要，发送方和接收方都需要设置一个缓冲区。

Go-Back-N（GBN）后退 N 帧协议

* 发送窗口大小：$1 \le W_T \le 2^n-1$，接收窗口大小：1；
* 出现失序的信息帧后要求发送方重发最后一个正确接受的信息帧之后所有未被确认的帧；
* 可以在收到多个正确数据帧后确认（累积确认）或自己有数据发送时再带上确认帧一起发回（捎带确认 piggybacking），确认号 ACKn 表示收到第 n 号帧，期望收到 n + 1 号帧。

Selective Repeat 选择重传协议

* 发送窗口大小接收窗口大小之和不能超过 $2^n$，且发送窗口等于接受窗口，故二者最大均为 $2^{n-1}$；
* 可以收下不按序的序号，只需重发差错或超时的数据帧，因此无累积确认；
* 缓冲区大小等于窗口数目大小；
* 接收方怀疑帧出错，会发送否定帧 NAK 给发送方要求重传指定帧。

注意接受窗口大小为 1 可以保证按序接收。

## 第4章 介质访问控制子层（小于10分）
### 4.2 多路访问协议（MAC协议）

**CSMA（Carrier Sense Multiple Access 载波侦听多路访问，注意与码分复用 CDMA 区分）**

若每个站点发送前先侦听信道，发现信道空闲后再发送会大大降低冲突可能。CSMA 就是依据这一思想，它相对于 ALOHA 多了一个载波侦听装置。

有三种 CSMA 协议：

* 1-坚持 CSMA（1-persistent CSMA）：侦听信道空闲则立刻发送，冲突则继续坚持侦听直到空闲（持即续侦听信道直到空闲时立刻发出）；
* 非坚持 CSMA（Non-persistent CSMA）：侦听信道空闲则立刻发送，如果忙则放弃侦听，等待随机时间后再重复上述过程。这降低了多个结点同时等待信号空闲同时发送数据造成的冲突；
* $p$-坚持 CSMA（$p$-persistent CSMA）：侦听信道空闲则以概率 $p$ 立即发送，以概率 $1-p$ 推迟到下一个时隙，冲突则继续坚持侦听直到空闲，相当于前两种方案的折中。

**CSMA/CD（CSMA with Collision Detection 载波侦听多路访问/碰撞检测）**

1-坚持 CSMA 中传播延迟影响较大。结点 A 开始发送数据时，其发送数据的信号还未到达 B，B 侦听到信道空闲则发出，这样会导致冲突。于是 CSMA/CD 改为边发送边侦听。

要求帧的传输时长不小于 2 倍的传播时延（因为考虑往返），即：

最小帧长 = 2 $\times$ 总线传播延迟 $\times$ 数据传输速率（注意传输和传播的区别）

二进制指数退避算法（binary exponential back-off algorithm）

1. 确定基本退避时间，一般选取 2 倍总线端到端传播时延即 $2\tau$；
2. 从集合 $\{0,1,\cdots,2^k-1\}$ 中随机选择一个数 $r$，则退避时间为 $2r\tau$，其中 $k=\min\{重传次数，10\}$，即重传超过 10 次时 $k$ 不再增大，恒定为 10；
3. 当重传达到 16 次仍不成功则说明网络太拥挤，抛弃此帧并向高层报告出错。

**CSMA/CA（CSMA with Collision Avoidance 载波侦听多路访问/碰撞避免）**

无线局域网不能简单搬用 CSMA/CD，原因如下：

1. 无线网中接收信号强度远远小于发送信号强度，很难准确检测碰撞；
2. 无线通信中存在“隐蔽站”问题。

在这种情况下，我们采取冲突避免的方式，即发送数据前先广播告知其他节点。

802.11 要求发送方发送完一帧后，需收到对方确认后才能发送下一帧。并且为了避免碰撞，802.11 规定所有站完成发送后必须等待一段很短的时间（继续监听）才能发送下一帧，这段时间称为帧间间隔（InterFrame Space，IFS）。

处理隐蔽站问题：RTS 和 CTS（又称冲突避免多路访问 MACA，Multiple Access with Collision Avoidance）

![](./assets/MACA.png)

如图所示，对于（a），A 和 D 都能将数据发送给 B，且当 A 发送消息给 B 时，D 是无法听见的，因此 D 此时也可能给 B 发送数据，这时就会产生冲突。为了避免这种问题，我们引进 RTS（Request To Send）和 CTS（Clear To Send）帧，虑 当 A 向 B 发送一帧时的规则如下：

1. A 首先给 B 发送一个 RTS 帧，如图（a）所示。这个短帧（30 字节）包含了随后将要发送的数据帧的长度：
2. 然后，B 用一个 CTS 作为应答，如图（b ）所示。CTS 帧也包含了数据长度（从 RTS 帧中复制过来）；
3. A 在收到了 CTS 帧之后开始传输。

其他站听到了这些帧的反应（**注意区分不同情况下其他站在数据帧发送时能否发送数据**）：

1. 如果一个站听到了 RTS 帧，那么它一定离 A 很近，它必须保持沉默，至少等待足够长的时间以便在无冲突情况下 CTS 被返回给 A（只需等待 CTS 到达 A 即可，不影响后续数据传输）；
2. 如果一个站昕到了 CTS ，则它一定离 B 很近，在接下来的数据传送过程中它必须一直保持沉默，只要检查 CTS 帧，该站就可以知道数据帧的长度（即数据传输要持续多久）。

例如，①图中 C 落在 A 的范围内，但不在 B 的范围内。因此它听到了发出的 RTS 但没有听到  CTS，只要它没有干扰 CTS ，那么在之后的数据帧传送过程中，它可以自由地发送任何信息。②相反，D 落在 B 的范围内，但不在 A 的范围内。它听不到 RTS 帧但听到了CTS 帧，所以它就延缓发送任何信息直到数据帧如期传送完毕。③ E 站听到了这两条控制消息，一样在数据帧完成之前它必须保持安静。

尽管有了这些防范措施，冲突仍有可能会发生。例如， 可能同时给 B 发送 RTS 帧。这些帧将发生冲突，因而丢失。在发生了冲突的情况下，一个不成功的发送方（即在期望的时间间隔内没有听到 CTS）将等待一段随机的时间，以后再重试。

### 4.3 以太网*

在不考虑以太网前导码（preamble）的情况下：

* 以太网帧的最短为 64 字节，帧中的数据不得少于 46 个字节，以太网帧头有 18 字节，小于以上长度的帧或数据需要在帧中加入“填充数据（pad）”；
* 以太网帧的最长为 1518 字节。我们所说的 MTU  以太网一般为 1500，加上以太网帧头 18 字节。注意802.3 规范已经把最大长度改为 1536（即 0x0600）了。

高速以太网：速率达到或超过 100Mb/s 的以太网，分类如下：

1. 100BASE-T 以太网：双绞线（T）
2. 吉比特以太网：千兆以太网
3. 10 吉比特以太网：只使用光纤作为传输媒体，只工作在全双工方式，因此没有争用问题，也不使用 CDMA/CD 协议。

### 4.7 数据链路层交换**

交换机的每个端口都有各自的 MAC 地址。

## 第5章 网络层（非常非常重要）
### 5.1 网络层的设计问题

两种常见的传输技术（transmission technology）：单播（unicasting，或称点到点（point-to-point）链路）和广播链路（broadcast links）。

### 5.2 单个网络中的路由算法
### 5.7 Internet的网络层**

**NAT 网络地址转换**

NAT 是指通过将专用网络地址转换为公用地址从而对外隐藏内部管理的 IP 地址。内部 IP 地址可重用，故 NAT 节省了对 IP 地址的消耗，并降低了内部网络受到攻击的风险。

私有 IP 地址（private IP address）网段如下：

1. A类：1 个 A 类网段 **10**.0.0.0-**10**.255.255.255
2. B 类：16 个 B 类网段 **172.16**.0.0-**172.31**.255.255
3. C类：256 个 C 类网段：**192.168.0**.0-**192.168.255**.255

**路由协议**

Internet 由大量的独立网络或自治系统（AS, Autonomous System）构成，并由不同的组织运营，这些组织通常是公司、大学或 ISP。在自己网络内部，一个组织可以使用自己的域内路由算法（intradomain routing），域内路由协议也称为内部网关协议（IGP，interior gateway protocol）。而域间路由（interdomain routing）问题中所有网络必须使用相同的域间路由协议和外部网关协议（EGP，exterior gateway protocol）。

RIP（Routing Information Protocol，路由信息协议）

采用距离矢量路由（distance vector routing）算法

OSPF（ Open Shortest Path First，开放最短路径优先）

采用链路状态路由算法（link state routing）

BGP（Border Gateway Protocol，边界网关协议）

采用路径矢量协议（path vector protocol）

## 第6章 传输层（非常重要）
### 6.1 传输服务
### 6.2 传输协议的要素
### 6.4 Internet传输协议: UDP

使用 UDP 总结：

DHCP、DNS、RIP、实时传输协议（Real-time Transport Protocol，RTP）

### 6.5 Internet传输协议: TCP

Telnet协议是TCP/IP 协议族中的一员，是Internet远程登录服务的标准协议和主要方式。它为用户提供了在本地计算机上完成远程主机工作的能力（TCP Port 23）、BGP、POP3、SMTP、IMAP、HTTP、FTP。

特别注意 TCP 的确认号是希望收到的下一个字节序号，不是滑动窗口 GBN 中目前收到的序号。

## 第7章 应用层（小于10分）
### 7.1 DNS——域名系统

**DNS 资源记录（resource record）**

* 格式为 Domain name 域名  Time to live 生存期  Class 类别  Type 类型  Value 值
* 域名：不一定需要包含 www；
* 生存期：指明了该条记录的稳定程度。极为稳定的信息会被分配一个很大的值，比如 86400（l 天的秒数〉，而非常不稳定的信息则会被分配一个较小的值，比如 60（l 分钟的秒数〉；
* 类别：对于 Internet 信息，它总是 IN 。对于非 Internet 信息，则可以使用其他的代码，但实际上很少见；
* 类型：如图所示

![](./assets/DNStype.png)

* 值：该字段的值可以是一个数字、一个域名或者一个 ASCII 字符串，其语义取决于记录的类型（详见上图中的描述）。

注意无论采取迭代查询还是递归查询，主机都只向本地域名服务器发请求，接下来本地域名服务器完成递归或迭代的任务。

### 7.2 电子邮件

**SMTP（Simple Mail Transfer Protocol，简单邮件传输协议）**

* TCP 端口号 25；
* 从用户代理到发送方邮件服务器，以及邮件服务器之间传送都是基于 SMTP（push）；

**MIME（Multipurpose Internet Mail Extensions，多用途网络邮件扩充）**

* RFC 5322 是 Internet 邮件格式的最新版本，最初的 Internet 邮件格式由 RFC 822 描述；
* 继续使用 RFC 822 格式（在 RFC 5322 之前 MIME 就己被提出），但在邮件体中增加了结构性，并且为传送非 ASCII 码（基础的只能传送 ASCII 码）的邮件定义了编码规则，以下是 MIME 支持的内容类型：

![](./assets/MIMEtype.png)

* MIME 主要包括以下三部分内容：① 5 个新的邮件首部字段，包括 MIME 版本（MIME-Version）、内容描述（Content-Description）、内容标识（Content-ld）、传送编码（Content-Transfer-Encoding）和内容类型（Content-Type）；②定义了许多邮件内容的格式，对多媒体电子邮件的表示方法进行了标准化；③定义了传送编码，可对任何内容格式进行转换，而不会被邮件系统改变。

**POP3（Post Office Protocol，邮局协议）**

* TCP 端口号 110；
* 用户读取文件时，用户代理向邮件服务器发出请求（pull）；
* 两种工作方式：下载并保留（用户可以再次读取邮件），下载并删除（读取后邮件服务器删除该邮件）。

**IMAP（Internet Message Access Protocol，因特网报文存取协议）**

* TCP 端口号 143 ；
* 用户读取文件时，用户代理向邮件服务器发出请求（pull）；
* 功能比 POP 复杂，用户可以执行很多命令，包括列表显示文件夹和邮件、获取邮件或者甚至部分邮件、给邮件标记供以后删除，并将邮件组织到各文件夹内，也可以不通过邮件号而是使用属性来寻址邮件。

**Webmail 网络邮件**

一种日益流行可提供电子邮件服务的是 Web，它利用 Web 为用户提供邮件服务。浏览器与邮件服务器之间采用 HTTP 协议接收发送邮件，不同邮件服务器之间使用 SMTP。

### 7.3 万维网（web, url, cookie, javascript, php）

HTTP：无连接（无需建立 HTTP 连接），无状态（不会记录曾经访问过的客户），HTTP/1.1 默认持久连接（persistent connection）

![](./assets/HTTPstatus.png)

上表为 HTTP 状态码示例，1×× 码实际上很少被使用，2×× 码意味着这个请求被成功地处理，并且返回了相应的内容〈如果有的话〉，3×× 码告诉客户应该检查其他地方，使用另一个不同的 URL 或在它自己的缓存中查找，4×× 码意味着由于客户错误而导致请求失败，比如无效请求或者不存在的页面，最后 5×× 错误码意味着服务器自身出现内部问题，有可能是服务器代码中有错误，也可能是临时负载过重。

CDN（Content Delivery Network）内容分发网络

其基本思路是尽可能避开互联网上有可能影响数据传输速度和稳定性的瓶颈和环节，使内容传输得更快、更稳定。通过在网络各处放置节点服务器所构成的在现有的互联网基础之上的一层智能虚拟网络，CDN 系统能够实时地根据网络流量和各节点的连接、负载状况以及到用户的距离和响应时间等综合信息将用户的请求重新导向离用户最近的服务节点上。其目的是使用户可就近取得所需内容，解决 Internet 网络拥挤的状况，提高用户访问网站的响应速度。
